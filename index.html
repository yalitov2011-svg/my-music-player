<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸµ ×”× ×’×Ÿ ×”××©×•×ª×£ ×©×œ ×™××œ×™</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body { 
            background-color: #121212; 
            color: white; 
            font-family: 'Segoe UI', sans-serif; 
            text-align: center; 
            margin: 0; padding: 20px;
        }
        
        h1 { text-shadow: 0 0 15px rgba(255, 0, 0, 0.7); margin-bottom: 10px; }
        p { color: #aaa; margin-bottom: 30px; }

        .control-panel {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 30px;
            width: 90%; max-width: 600px;
        }

        input { 
            padding: 12px; 
            border-radius: 30px; 
            border: none; 
            width: 60%; 
            outline: none; 
            font-size: 16px;
            padding-right: 15px;
        }

        button { 
            padding: 12px 25px; 
            background: #ff0000; 
            color: white; 
            border: none; 
            cursor: pointer; 
            border-radius: 30px; 
            font-weight: bold; 
            font-size: 16px;
            transition: 0.3s;
        }
        button:hover { transform: scale(1.05); background: #cc0000; }

        .player-box { 
            width: 100%; max-width: 800px; 
            aspect-ratio: 16/9; 
            background: #000; 
            margin: 0 auto; 
            border-radius: 15px; 
            overflow: hidden; 
            box-shadow: 0 0 50px rgba(255,0,0,0.2);
            border: 2px solid #333;
        }
        
        iframe { width: 100%; height: 100%; border: none; }
        
        .status { 
            margin-top: 15px; 
            font-size: 14px; 
            color: #00ff00; 
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <h1>ğŸ”Š × ×’×Ÿ ××©×•×ª×£ LIVE</h1>
    <p>×›×œ ××™ ×©× ×›× ×¡ ×œ×§×™×©×•×¨ ×”×–×” - ×©×•××¢ ×‘×“×™×•×§ ××ª ××” ×©××ª×” ×©×•××¢!</p>

    <div class="control-panel">
        <input type="text" id="searchQuery" placeholder="×—×¤×© ×©×™×¨ (×œ××©×œ: ×¢×•××¨ ××“×)...">
        <button onclick="searchAndSync()">× ×’×Ÿ ×œ×›×•×œ× â–¶</button>
        <div class="status" id="statusText">××—×•×‘×¨ ×•×××ª×™×Ÿ ×œ×¤×§×•×“×”... ğŸ“¡</div>
    </div>

    <div class="player-box">
        <div id="player"></div>
    </div>

    <script>
        // --- ×”×’×“×¨×•×ª ×”×—×™×‘×•×¨ ×©×œ×š (×œ×§×—×ª×™ ××”×ª××•× ×” ×©×©×œ×—×ª) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDKN3qgnvUP4SZX9aOAaThnDI4vUjjVw9A",
            authDomain: "musicsync-58d86.firebaseapp.com",
            projectId: "musicsync-58d86",
            storageBucket: "musicsync-58d86.firebasestorage.app",
            messagingSenderId: "367949692420",
            appId: "1:367949692420:web:414a34b0c14dc46e51ff51",
            // ×”×•×¡×¤×ª×™ ××ª ×›×ª×•×‘×ª ×”×©×¨×ª ×‘××•×¤×Ÿ ××•×˜×•××˜×™
            databaseURL: "https://musicsync-58d86-default-rtdb.firebaseio.com"
        };

        // ××ª×—×•×œ ×”××¢×¨×›×ª
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const YOUTUBE_API_KEY = 'AIzaSyAuLutPPSJlZJKkfBrzRNURSibcqkeeA60'; 

        let player;
        let isSyncing = false; 

        // ×˜×¢×™× ×ª ×™×•×˜×™×•×‘
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: '', 
                playerVars: { 
                    'autoplay': 1, 
                    'controls': 1,
                    'rel': 0,
                    'playsinline': 1
                },
                events: {
                    'onReady': connectToFirebase, 
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // --- ×—×™×‘×•×¨ ×œ××•×— ×”××©×•×ª×£ ---
        function connectToFirebase() {
            const syncRef = db.ref('current_song');

            syncRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (!data) return;

                document.getElementById('statusText').innerText = `ğŸ¶ ×× ×’×Ÿ ×›×¨×’×¢ ××¦×œ ×›×•×œ×: ${data.title}`;

                // ×× ×–×” ×©×™×¨ ×—×“×© - ×˜×¢×Ÿ ××•×ª×•
                if (player.getVideoData().video_id !== data.videoId) {
                    isSyncing = true;
                    player.loadVideoById(data.videoId);
                    setTimeout(() => isSyncing = false, 1000);
                }

                // ×× ××™×©×”×• ×¢×¦×¨ ××• ×”×¤×¢×™×œ
                const playerState = player.getPlayerState();
                if (data.status === 2 && playerState !== 2) {
                    player.pauseVideo();
                } else if (data.status === 1 && playerState !== 1 && playerState !== 3) {
                    player.playVideo();
                }
            });
        }

        // --- ×›×©××ª×” ×œ×•×—×¥ ×¢×œ ××©×”×• ×‘× ×’×Ÿ ---
        function onPlayerStateChange(event) {
            if (isSyncing) return; 

            // 1=Play, 2=Pause
            if (event.data === 1 || event.data === 2) {
                db.ref('current_song').update({ status: event.data });
            }
        }

        // --- ×—×™×¤×•×© ×©×™×¨ ×•×©×œ×™×—×” ×œ×›×•×œ× ---
        async function searchAndSync() {
            const query = document.getElementById('searchQuery').value;
            if (!query) return;

            const btn = document.querySelector('button');
            btn.innerText = "×©×•×œ×—...";
            
            // ×˜×¨×™×§: ×”×•×¡×¤×ª lyrics ×¢×•×–×¨×ª ×œ××¦×•× ×©×™×¨×™× ×©×¢×•×‘×“×™×
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=1&q=${encodeURIComponent(query + " lyrics audio")}&videoEmbeddable=true&key=${YOUTUBE_API_KEY}`;
            
            try {
                const res = await fetch(url);
                const data = await res.json();
                
                if (!data.items || data.items.length === 0) {
                    alert("×œ× × ××¦× ×©×™×¨, × ×¡×” ×©× ××—×¨");
                    btn.innerText = "× ×’×Ÿ ×œ×›×•×œ× â–¶";
                    return;
                }

                const video = data.items[0];

                // ×©×œ×™×—×” ×œ×©×¨×ª - ×–×” ×™×¢×“×›×Ÿ ××ª ×›×•×œ×!
                db.ref('current_song').set({
                    videoId: video.id.videoId,
                    title: video.snippet.title,
                    status: 1
                });
                
                document.getElementById('searchQuery').value = "";
                btn.innerText = "× ×’×Ÿ ×œ×›×•×œ× â–¶";

            } catch (error) {
                console.error(error);
                alert("×©×’×™××” ×‘×—×™×¤×•×©");
                btn.innerText = "× ×’×Ÿ ×œ×›×•×œ× â–¶";
            }
        }

        // ×”×¤×¢×œ×” ×‘×× ×˜×¨
        document.getElementById('searchQuery').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') searchAndSync();
        });
    </script>
</body>
</html>
